// tools/final-issue-test.js
/**
 * Final, isolated test script to create a GitHub issue.
 * This script is designed to bypass any potential caching issues.
 */

const path = require('path');
require('dotenv').config({ path: path.resolve(__dirname, '../config.secrets') });

const { createGitHubIssue } = require('./github-issue-creator');

async function runFinalTest() {
  console.log('üöÄ Starting final, isolated test...');

  // Verify that the environment variable is loaded correctly
  if (!process.env.GITHUB_TOKEN) 
    console.error('‚ùå FINAL TEST FAILED: GITHUB_TOKEN not found after loading .env file.');
    return;
  }
  if (!process.env.GITHUB_REPO) { 
    console.error('‚ùå FINAL TEST FAILED: GITHUB_REPO not found after loading .env file.');
    return;
  }

  console.log('‚úÖ Environment variables seem to be loaded correctly.');

  const title = 'Final System Test: Issue Creation';
  const body =
    'This issue was created by a clean, isolated test script to confirm the functionality of the entire chain.';
  const labels = ['bug', 'autogenerated', 'final-test'];

  try {
    await createGitHubIssue(title, body, labels);
    console.log('‚úÖ‚úÖ‚úÖ FINAL TEST SUCCEEDED! The GitHub issue was created.');
  } catch (error) {
    console.error('‚ùå‚ùå‚ùå FINAL TEST FAILED during issue creation:', error.message);
  }
}

runFinalTest();
