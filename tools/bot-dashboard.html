<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>🤖 BurniToken Bot Dashboard</title>
    <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: #333;
          min-height: 100vh;
          padding: 20px;
      }

      .dashboard {
          max-width: 1400px;
          margin: 0 auto;
      }

      .header {
          text-align: center;
          color: white;
          margin-bottom: 30px;
      }

      .header h1 {
          font-size: 2.5rem;
          margin-bottom: 10px;
          text-shadow: 0 2px 10px rgba(0,0,0,0.3);
      }

      .header .subtitle {
          font-size: 1.1rem;
          opacity: 0.9;
      }

      .controls {
          background: white;
          border-radius: 15px;
          padding: 20px;
          margin-bottom: 30px;
          box-shadow: 0 10px 30px rgba(0,0,0,0.1);
          display: flex;
          gap: 15px;
          align-items: center;
          flex-wrap: wrap;
      }

      .btn {
          padding: 12px 24px;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.5px;
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          gap: 8px;
      }

      .btn:hover {
          transform: translateY(-2px);
          box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      }

      .btn-start { background: #10b981; color: white; }
      .btn-stop { background: #ef4444; color: white; }
      .btn-restart { background: #f59e0b; color: white; }
      .btn-refresh { background: #6366f1; color: white; }

      .status-overview {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 20px;
          margin-bottom: 30px;
      }

      .status-card {
          background: white;
          border-radius: 15px;
          padding: 20px;
          text-align: center;
          box-shadow: 0 5px 20px rgba(0,0,0,0.1);
          transition: transform 0.3s ease;
      }

      .status-card:hover {
          transform: translateY(-5px);
      }

      .status-card .number {
          font-size: 2.5rem;
          font-weight: bold;
          margin-bottom: 5px;
      }

      .status-card .label {
          color: #666;
          font-size: 0.9rem;
          text-transform: uppercase;
          letter-spacing: 1px;
      }

      .status-card.running .number { color: #10b981; }
      .status-card.error .number { color: #ef4444; }
      .status-card.warning .number { color: #f59e0b; }
      .status-card.stopped .number { color: #6b7280; }

      .bots-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
          gap: 20px;
          margin-bottom: 30px;
      }

      .bots-grid.compact {
          grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
          gap: 15px;
      }

      .bots-grid.expanded {
          grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
          gap: 25px;
      }

      .priority-section {
          margin-bottom: 40px;
      }

      .priority-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          background: rgba(255,255,255,0.1);
          padding: 15px 20px;
          border-radius: 10px;
          margin-bottom: 20px;
          color: white;
          backdrop-filter: blur(10px);
      }

      .priority-title {
          font-size: 1.3rem;
          font-weight: bold;
          display: flex;
          align-items: center;
          gap: 10px;
      }

      .priority-controls {
          display: flex;
          gap: 10px;
      }

      .priority-btn {
          padding: 6px 12px;
          border: none;
          border-radius: 6px;
          background: rgba(255,255,255,0.2);
          color: white;
          cursor: pointer;
          font-size: 0.9rem;
          transition: all 0.2s ease;
      }

      .priority-btn:hover {
          background: rgba(255,255,255,0.3);
      }

      .critical-section .priority-header {
          background: linear-gradient(135deg, #ef4444, #dc2626);
      }

      .important-section .priority-header {
          background: linear-gradient(135deg, #f59e0b, #d97706);
      }

      .helpful-section .priority-header {
          background: linear-gradient(135deg, #10b981, #059669);
      }

      .bot-card {
          background: white;
          border-radius: 15px;
          padding: 20px;
          box-shadow: 0 5px 20px rgba(0,0,0,0.1);
          transition: all 0.3s ease;
          border-left: 5px solid #ddd;
          position: relative;
          resize: both;
          min-width: 300px;
          min-height: 220px;
          max-width: 800px;
          max-height: 600px;
          overflow: auto;
      }

      .bot-card.github-special {
          border-left-color: #24292e;
          background: linear-gradient(135deg, #f6f8fa 0%, #ffffff 100%);
      }

      .bot-card.deployment-special {
          border-left-color: #28a745;
          background: linear-gradient(135deg, #f0fff4 0%, #ffffff 100%);
      }

      .bot-card.security-special {
          border-left-color: #dc3545;
          background: linear-gradient(135deg, #fff5f5 0%, #ffffff 100%);
      }

      .bot-card.ai-special {
          border-left-color: #6f42c1;
          background: linear-gradient(135deg, #f8f7ff 0%, #ffffff 100%);
      }

      .bot-card.performance-special {
          border-left-color: #fd7e14;
          background: linear-gradient(135deg, #fff8f0 0%, #ffffff 100%);
      }

      .bot-card.compact {
          padding: 15px;
          border-radius: 10px;
      }

      .bot-card.expanded {
          padding: 30px;
          border-radius: 20px;
      }

      .bot-card:hover {
          transform: translateY(-3px);
          box-shadow: 0 10px 40px rgba(0,0,0,0.15);
      }

      .bot-card.running { border-left-color: #10b981; }
      .bot-card.error { border-left-color: #ef4444; }
      .bot-card.warning { border-left-color: #f59e0b; }
      .bot-card.stopped { border-left-color: #6b7280; }

      .bot-card.critical::before {
          content: '🔴';
          position: absolute;
          top: 10px;
          right: 10px;
          font-size: 1.2rem;
      }

      .bot-card.important::before {
          content: '🟠';
          position: absolute;
          top: 10px;
          right: 10px;
          font-size: 1.2rem;
      }

      .special-metrics {
          margin-top: 15px;
          padding: 10px;
          background: rgba(0,0,0,0.02);
          border-radius: 8px;
          border: 1px solid rgba(0,0,0,0.05);
      }

      .metric-row {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 8px;
          font-size: 0.85rem;
      }

      .metric-row:last-child {
          margin-bottom: 0;
      }

      .metric-label {
          color: #666;
          font-weight: 500;
      }

      .metric-value {
          font-weight: 600;
          padding: 2px 6px;
          border-radius: 4px;
          font-size: 0.8rem;
      }

      .metric-value.good { background: #dcfce7; color: #166534; }
      .metric-value.warning { background: #fef3c7; color: #92400e; }
      .metric-value.error { background: #fecaca; color: #991b1b; }
      .metric-value.info { background: #dbeafe; color: #1e40af; }

      .github-metrics .metric-value {
          background: #f6f8fa;
          color: #24292e;
          border: 1px solid #e1e4e8;
      }

      .window-controls {
          position: absolute;
          top: 10px;
          right: 10px;
          display: flex;
          gap: 5px;
          opacity: 0;
          transition: opacity 0.3s ease;
      }

      .bot-card:hover .window-controls {
          opacity: 1;
      }

      .window-btn {
          width: 20px;
          height: 20px;
          border-radius: 50%;
          border: none;
          cursor: pointer;
          font-size: 10px;
          display: flex;
          align-items: center;
          justify-content: center;
      }

      .window-btn.minimize { background: #fbbf24; color: white; }
      .window-btn.maximize { background: #10b981; color: white; }
      .window-btn.close { background: #ef4444; color: white; }
          opacity: 0.7;
          transition: all 0.2s ease;
      }

      .resize-handle:hover {
          opacity: 1;
          background: #d1d5db;
      }

      .bot-header {
          display: flex;
          justify-content: between;
          align-items: center;
          margin-bottom: 15px;
      }

      .bot-name {
          font-size: 1.2rem;
          font-weight: bold;
          flex: 1;
      }

      .bot-status {
          padding: 6px 12px;
          border-radius: 20px;
          font-size: 0.8rem;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.5px;
      }

      .bot-status.running { background: #dcfce7; color: #166534; }
      .bot-status.error { background: #fef2f2; color: #991b1b; }
      .bot-status.warning { background: #fef3c7; color: #92400e; }
      .bot-status.stopped { background: #f3f4f6; color: #374151; }

      .bot-description {
          color: #666;
          margin-bottom: 20px;
          line-height: 1.5;
      }

      .bot-metrics {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 15px;
          margin-bottom: 20px;
      }

      .metric {
          text-align: center;
          padding: 10px;
          background: #f8fafc;
          border-radius: 8px;
      }

      .metric-value {
          font-size: 1.5rem;
          font-weight: bold;
          color: #333;
      }

      .metric-label {
          font-size: 0.8rem;
          color: #666;
          text-transform: uppercase;
          letter-spacing: 0.5px;
      }

      .health-bar {
          width: 100%;
          height: 8px;
          background: #e5e7eb;
          border-radius: 4px;
          overflow: hidden;
          margin-bottom: 15px;
      }

      .health-fill {
          height: 100%;
          transition: width 0.3s ease;
          border-radius: 4px;
      }

      .health-fill.healthy { background: #10b981; }
      .health-fill.warning { background: #f59e0b; }
      .health-fill.error { background: #ef4444; }

      .bot-actions {
          display: flex;
          gap: 10px;
      }

      .bot-btn {
          flex: 1;
          padding: 8px 16px;
          border: none;
          border-radius: 6px;
          cursor: pointer;
          font-size: 0.9rem;
          font-weight: 600;
          transition: all 0.2s ease;
      }

      .bot-btn:hover {
          transform: translateY(-1px);
      }

      .bot-btn.start { background: #10b981; color: white; }
      .bot-btn.stop { background: #ef4444; color: white; }
      .bot-btn.restart { background: #f59e0b; color: white; }

      .loading {
          display: inline-block;
          width: 20px;
          height: 20px;
          border: 3px solid rgba(255,255,255,.3);
          border-radius: 50%;
          border-top-color: #fff;
          animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
          to { transform: rotate(360deg); }
      }

      .error-list {
          background: #fef2f2;
          border: 1px solid #fecaca;
          border-radius: 8px;
          padding: 10px;
          margin-top: 10px;
          font-size: 0.9rem;
      }

      .error-item {
          color: #991b1b;
          margin-bottom: 5px;
      }

      .timestamp {
          color: #666;
          font-size: 0.8rem;
          margin-top: 10px;
      }

      .auto-refresh {
          position: fixed;
          top: 20px;
          right: 20px;
          background: rgba(255,255,255,0.9);
          padding: 10px;
          border-radius: 8px;
          font-size: 0.9rem;
          color: #666;
      }
    </style>
  </head>
  <body>
    <div class="auto-refresh">🔄 Auto-Refresh: <span id="refresh-countdown">30</span>s</div>

    <div class="dashboard">
      <div class="header">
        <h1>🤖 BurniToken Bot Dashboard</h1>
        <div class="subtitle">Zentrale Überwachung aller automatisierten Worker & Bots</div>
      </div>

      <div class="controls">
        <button class="btn btn-start" onclick="startAllBots()">▶️ Alle Starten</button>
        <button class="btn btn-stop" onclick="stopAllBots()">⏹️ Alle Stoppen</button>
        <button class="btn btn-restart" onclick="restartAllBots()">🔄 Alle Neustarten</button>
        <button class="btn btn-refresh" onclick="refreshData()">🔁 Aktualisieren</button>
        <div style="margin-left: auto; display: flex; gap: 10px">
          <button class="btn" onclick="toggleViewMode()" style="background: #6366f1; color: white">
            📏 Ansicht
          </button>
          <button class="btn" onclick="toggleLayout()" style="background: #8b5cf6; color: white">
            🔀 Layout
          </button>
        </div>
      </div>

      <div class="status-overview" id="status-overview">
        <!-- Wird dynamisch gefüllt -->
      </div>

      <!-- KRITISCHE BOTS (Priorität 1) -->
      <div class="priority-section critical-section">
        <div class="priority-header">
          <div class="priority-title">🔴 KRITISCHE BOTS - Produktions-relevant</div>
          <div class="priority-controls">
            <button class="priority-btn" onclick="startPriorityBots(1)">Alle Starten</button>
            <button class="priority-btn" onclick="stopPriorityBots(1)">Alle Stoppen</button>
          </div>
        </div>
        <div class="bots-grid" id="critical-bots-grid">
          <!-- Kritische Bots -->
        </div>
      </div>

      <!-- WICHTIGE BOTS (Priorität 2) -->
      <div class="priority-section important-section">
        <div class="priority-header">
          <div class="priority-title">🟠 WICHTIGE BOTS - Performance & APIs</div>
          <div class="priority-controls">
            <button class="priority-btn" onclick="startPriorityBots(2)">Alle Starten</button>
            <button class="priority-btn" onclick="stopPriorityBots(2)">Alle Stoppen</button>
          </div>
        </div>
        <div class="bots-grid" id="important-bots-grid">
          <!-- Wichtige Bots -->
        </div>
      </div>

      <!-- HILFS-BOTS (Priorität 3) -->
      <div class="priority-section helpful-section">
        <div class="priority-header">
          <div class="priority-title">🟢 HILFS-BOTS - Support & Maintenance</div>
          <div class="priority-controls">
            <button class="priority-btn" onclick="startPriorityBots(3)">Alle Starten</button>
            <button class="priority-btn" onclick="stopPriorityBots(3)">Alle Stoppen</button>
          </div>
        </div>
        <div class="bots-grid" id="helpful-bots-grid">
          <!-- Hilfs-Bots -->
        </div>
      </div>
    </div>

    <script>
      let refreshInterval;
      let countdown = 30;
      let currentViewMode = 'normal'; // normal, compact, expanded
      let currentLayout = 'priority'; // priority, unified

      // Auto-Refresh
      function startAutoRefresh() {
          clearInterval(refreshInterval);
          refreshInterval = setInterval(() => {
              countdown--;
              document.getElementById('refresh-countdown').textContent = countdown;

              if (countdown <= 0) {
                  refreshData();
                  countdown = 30;
              }
          }, 1000);
      }

      // View Mode Toggle
      function toggleViewMode() {
          const modes = ['normal', 'compact', 'expanded'];
          const currentIndex = modes.indexOf(currentViewMode);
          currentViewMode = modes[(currentIndex + 1) % modes.length];

          // Apply to all grids
          const grids = document.querySelectorAll('.bots-grid');
          grids.forEach(grid => {
              grid.className = `bots-grid ${currentViewMode}`;
          });

          // Apply to all cards
          const cards = document.querySelectorAll('.bot-card');
          cards.forEach(card => {
              if (currentViewMode === 'compact') {
                  card.classList.add('compact');
                  card.classList.remove('expanded');
              } else if (currentViewMode === 'expanded') {
                  card.classList.add('expanded');
                  card.classList.remove('compact');
              } else {
                  card.classList.remove('compact', 'expanded');
              }
          });
      }

      // Layout Toggle
      function toggleLayout() {
          currentLayout = currentLayout === 'priority' ? 'unified' : 'priority';

          if (currentLayout === 'unified') {
              // Alle Bots in ein Grid
              document.querySelectorAll('.priority-section').forEach(section => {
                  section.style.display = 'none';
              });

              const unifiedGrid = document.getElementById('bots-grid') || createUnifiedGrid();
              unifiedGrid.style.display = 'grid';
          } else {
              // Bots nach Priorität getrennt
              document.querySelectorAll('.priority-section').forEach(section => {
                  section.style.display = 'block';
              });

              const unifiedGrid = document.getElementById('bots-grid');
              if (unifiedGrid) unifiedGrid.style.display = 'none';
          }
      }

      function createUnifiedGrid() {
          const container = document.querySelector('.dashboard');
          const unifiedGrid = document.createElement('div');
          unifiedGrid.id = 'bots-grid';
          unifiedGrid.className = 'bots-grid';
          container.appendChild(unifiedGrid);
          return unifiedGrid;
      }

      // Daten vom Server laden
      async function refreshData() {
          try {
              const response = await fetch('/api/bot-status');
              const data = await response.json();

              updateStatusOverview(data);

              if (currentLayout === 'priority') {
                  updateBotsByPriority(data.bots);
              } else {
                  updateBotsGrid(data.bots);
              }

              countdown = 30;
              document.getElementById('refresh-countdown').textContent = countdown;

          } catch (error) {
              console.error('Fehler beim Laden der Daten:', error);
              // Fallback: Mock-Daten für Demo
              loadMockData();
          }
      }

      // Bots nach Priorität aufteilen
      function updateBotsByPriority(bots) {
          const priorityGroups = {
              1: bots.filter(bot => getPriority(bot.id) === 1),
              2: bots.filter(bot => getPriority(bot.id) === 2),
              3: bots.filter(bot => getPriority(bot.id) === 3)
          };

          updateBotsInGrid('critical-bots-grid', priorityGroups[1], 'critical');
          updateBotsInGrid('important-bots-grid', priorityGroups[2], 'important');
          updateBotsInGrid('helpful-bots-grid', priorityGroups[3], 'helpful');
      }

      function updateBotsInGrid(gridId, bots, priorityClass) {
          const grid = document.getElementById(gridId);
          if (!grid) return;

          grid.innerHTML = bots.map(bot => createBotCard(bot, priorityClass)).join('');
      }

      function createBotCard(bot, priorityClass = '') {
          const specialMetrics = getSpecialMetrics(bot);
          const specialClass = bot.specialClass || '';

          return `
              <div class="bot-card ${bot.status} ${priorityClass} ${currentViewMode} ${specialClass}">
                  <div class="window-controls">
                      <button class="window-btn minimize" onclick="minimizeCard(this)" title="Minimieren">−</button>
                      <button class="window-btn maximize" onclick="maximizeCard(this)" title="Maximieren">□</button>
                      <button class="window-btn close" onclick="closeCard(this)" title="Temporär ausblenden">×</button>
                  </div>

                  <div class="bot-header">
                      <div class="bot-name">${bot.name}</div>
                      <div class="bot-status ${bot.status}">${getStatusText(bot.status)}</div>
                  </div>

                  <div class="bot-description">
                      ${getBotDescription(bot.id)}
                  </div>

                  ${specialMetrics ? `
                      <div class="special-metrics">
                          ${specialMetrics}
                      </div>
                  ` : ''}

                  <div class="health-bar">
                      <div class="health-fill ${getHealthClass(bot.health?.score || 0)}"
                           style="width: ${bot.health?.score || 0}%"></div>
                  </div>

                  <div class="bot-metrics">
                      <div class="metric">
                          <div class="metric-value">${formatUptime(bot.uptime || 0)}</div>
                          <div class="metric-label">Uptime</div>
                      </div>
                      <div class="metric">
                          <div class="metric-value">${bot.metrics?.memory || 0}MB</div>
                          <div class="metric-label">Memory</div>
                      </div>
                      <div class="metric">
                          <div class="metric-value">${bot.metrics?.cpu || 0}%</div>
                          <div class="metric-label">CPU</div>
                      </div>
                      <div class="metric">
                          <div class="metric-value">${bot.restartCount || 0}</div>
                          <div class="metric-label">Restarts</div>
                      </div>
                  </div>

                  <div class="bot-actions">
                      <button class="btn-small btn-start" onclick="startBot('${bot.id}')" ${bot.status === 'running' ? 'disabled' : ''}>
                          ▶️ Start
                      </button>
                      <button class="btn-small btn-stop" onclick="stopBot('${bot.id}')" ${bot.status === 'stopped' ? 'disabled' : ''}>
                          ⏹️ Stop
                      </button>
                      <button class="btn-small btn-restart" onclick="restartBot('${bot.id}')">
                          🔄 Restart
                      </button>
                  </div>

                  <div class="resize-handle">⋯</div>
              </div>
          `;
      }

                  ${bot.health?.issues?.length > 0 ? `
                      <div class="error-list">
                          ${bot.health.issues.map(issue => `
                              <div class="error-item">⚠️ ${issue}</div>
                          `).join('')}
                      </div>
                  ` : ''}

                  <div class="bot-actions">
                      <button class="bot-btn start" onclick="startBot('${bot.id}')"
                              ${bot.status === 'running' ? 'disabled' : ''}>
                          Start
                      </button>
                      <button class="bot-btn stop" onclick="stopBot('${bot.id}')"
                              ${bot.status === 'stopped' ? 'disabled' : ''}>
                          Stop
                      </button>
                      <button class="bot-btn restart" onclick="restartBot('${bot.id}')">
                          Restart
                      </button>
                  </div>

                  <div class="timestamp">
                      ${bot.lastStart ? `Gestartet: ${new Date(bot.lastStart).toLocaleString('de-DE')}` : 'Nicht gestartet'}
                  </div>

                  <div class="resize-handle" onclick="toggleCardSize(this)" title="Kartengröße ändern">
                      ⟲
                  </div>
              </div>
          `;
      }

      // Spezielle Metriken für bestimmte Bots
      function getSpecialMetrics(bot) {
          switch (bot.id) {
              case 'github-repository-manager':
                  const metrics = bot.health?.metrics;
                  if (metrics) {
                      return `
                          <div class="github-metrics" style="background: #f8fafc; padding: 10px; border-radius: 6px; margin: 10px 0;">
                              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem;">
                                  <div>📋 Offene Issues: <strong>${metrics.openIssues}</strong></div>
                                  <div>✅ Geschlossene: <strong>${metrics.closedIssues}</strong></div>
                                  <div>🔄 Offene PRs: <strong>${metrics.openPRs}</strong></div>
                                  <div>✅ Merged PRs: <strong>${metrics.mergedPRs}</strong></div>
                              </div>
                          </div>
                      `;
                  }
                  break;

              case 'deployment-pipeline':
                  return `
                      <div class="deployment-status" style="background: #f0f9ff; padding: 10px; border-radius: 6px; margin: 10px 0;">
                          <div style="font-size: 0.9rem;">
                              🚀 Letztes Deployment: <strong>vor 2h</strong><br>
                              ✅ CI/CD Status: <strong>Aktiv</strong><br>
                              📊 Success Rate: <strong>98.5%</strong>
                          </div>
                      </div>
                  `;

              case 'production-monitor':
                  return `
                      <div class="production-status" style="background: #fef2f2; padding: 10px; border-radius: 6px; margin: 10px 0;">
                          <div style="font-size: 0.9rem;">
                              🌍 Website Status: <strong>Online</strong><br>
                              ⚡ Response Time: <strong>245ms</strong><br>
                              📈 Uptime: <strong>99.9%</strong>
                          </div>
                      </div>
                  `;
          }
          return null;
      }

      // Status-Übersicht aktualisieren
      function updateStatusOverview(data) {
          const overview = document.getElementById('status-overview');
          const bots = data.bots || [];

          const running = bots.filter(b => b.status === 'running').length;
          const error = bots.filter(b => b.status === 'error').length;
          const stopped = bots.filter(b => b.status === 'stopped').length;
          const total = bots.length;

          overview.innerHTML = `
              <div class="status-card running">
                  <div class="number">${running}</div>
                  <div class="label">Laufend</div>
              </div>
              <div class="status-card error">
                  <div class="number">${error}</div>
                  <div class="label">Fehler</div>
              </div>
              <div class="status-card stopped">
                  <div class="number">${stopped}</div>
                  <div class="label">Gestoppt</div>
              </div>
              <div class="status-card">
                  <div class="number">${total}</div>
                  <div class="label">Gesamt</div>
              </div>
          `;
      }

      // Priority-basierte Actions
      async function startPriorityBots(priority) {
          const bots = getAllBotsByPriority(priority);
          for (const botId of bots) {
              await startBot(botId);
              await sleep(1000); // 1 Sekunde zwischen Starts
          }
      }

      async function stopPriorityBots(priority) {
          const bots = getAllBotsByPriority(priority);
          for (const botId of bots) {
              await stopBot(botId);
          }
      }

      function getAllBotsByPriority(priority) {
          const priorityMapping = {
              1: ['deployment-pipeline', 'production-monitor', 'github-repository-manager', 'security-watchdog'],
              2: ['gemini-ai-chef', 'google-search-console-bot', 'performance-monitor', 'seo-monitor', 'api-orchestrator', 'content-manager'],
              3: ['accessibility-checker', 'price-oracle', 'recovery-manager', 'asset-optimizer', 'log-aggregator', 'social-media-manager', 'database-manager']
          };
          return priorityMapping[priority] || [];
      }

      function getPriority(botId) {
          const priorities = {
              'deployment-pipeline': 1,
              'production-monitor': 1,
              'github-repository-manager': 1,
              'security-watchdog': 1,
              'gemini-ai-chef': 2,
              'google-search-console-bot': 2,
              'performance-monitor': 2,
              'seo-monitor': 2,
              'api-orchestrator': 2,
              'content-manager': 2,
              'accessibility-checker': 3,
              'price-oracle': 3,
              'recovery-manager': 3,
              'asset-optimizer': 3,
              'log-aggregator': 3,
              'social-media-manager': 3,
              'database-manager': 3
          };
          return priorities[botId] || 3;
      }

      function toggleCardSize(element) {
          const card = element.closest('.bot-card');
          if (card.classList.contains('compact')) {
              card.classList.remove('compact');
              card.classList.add('expanded');
          } else if (card.classList.contains('expanded')) {
              card.classList.remove('expanded');
              card.classList.add('compact');
          } else {
              card.classList.add('compact');
          }
      }

      function getStatusText(status) {
          const statusTexts = {
              'running': 'Läuft',
              'stopped': 'Gestoppt',
              'error': 'Fehler',
              'warning': 'Warnung',
              'starting': 'Startet...',
              'stopping': 'Stoppt...'
          };
          return statusTexts[status] || status;
      }

      function sleep(ms) {
          return new Promise(resolve => setTimeout(resolve, ms));
      }

      // Window Control Funktionen
      function minimizeCard(btn) {
          const card = btn.closest('.bot-card');
          if (card.style.height === '80px') {
              card.style.height = '';
              card.style.overflow = 'auto';
              btn.textContent = '−';
              btn.title = 'Minimieren';
          } else {
              card.style.height = '80px';
              card.style.overflow = 'hidden';
              btn.textContent = '+';
              btn.title = 'Erweitern';
          }
      }

      function maximizeCard(btn) {
          const card = btn.closest('.bot-card');
          if (card.style.width === '100%') {
              card.style.width = '';
              card.style.height = '';
              card.style.position = '';
              card.style.zIndex = '';
              btn.textContent = '□';
              btn.title = 'Maximieren';
          } else {
              card.style.width = '100%';
              card.style.height = '400px';
              card.style.position = 'relative';
              card.style.zIndex = '10';
              btn.textContent = '⬜';
              btn.title = 'Verkleinern';
          }
      }

      function closeCard(btn) {
          const card = btn.closest('.bot-card');
          card.style.display = 'none';

          // Nach 3 Sekunden wieder einblenden
          setTimeout(() => {
              card.style.display = 'block';
          }, 3000);
      }

      // Bot-Actions
      async function startBot(botId) {
          await executeAction('start', botId);
      }

      async function stopBot(botId) {
          await executeAction('stop', botId);
      }

      async function restartBot(botId) {
          await executeAction('restart', botId);
      }

      async function startAllBots() {
          await executeAction('start-all');
      }

      async function stopAllBots() {
          await executeAction('stop-all');
      }

      async function restartAllBots() {
          await executeAction('restart-all');
      }

      async function executeAction(action, botId = null) {
          try {
              const url = `/api/bot-action/${action}${botId ? `/${botId}` : ''}`;
              const response = await fetch(url, { method: 'POST' });

              if (response.ok) {
                  // Sofortige Aktualisierung nach Aktion
                  setTimeout(refreshData, 1000);
              } else {
                  alert('Fehler beim Ausführen der Aktion');
              }
          } catch (error) {
              console.error('Action-Fehler:', error);
              alert('Netzwerkfehler');
          }
      }

      // Hilfsfunktionen
      function getBotDescription(botId) {
          const descriptions = {
              'deployment-pipeline': '🚀 CI/CD Pipeline, GitHub Actions, Netlify Auto-Deploy',
              'production-monitor': '🔴 Live Website Monitoring, Uptime, Critical Alerts',
              'github-repository-manager': '📦 Issues, PRs, Releases, Repository Health',
              'security-watchdog': '🛡️ Real-time Security, Vulnerabilities, Threat Detection',
              'gemini-ai-chef': '🧠 KI Code Reviews, Smart Optimizations, AI Suggestions',
              'google-search-console-bot': '🔍 GSC Integration, Indexierung, Search Performance',
              'performance-monitor': '⚡ Core Web Vitals, Lighthouse, Speed Optimization',
              'seo-monitor': '📈 SEO Rankings, Meta-Tags, Search Visibility',
              'api-orchestrator': '🌐 Multi-API Management, Failover, Rate Limiting',
              'content-manager': '📝 Auto Content Updates, i18n, CMS Integration',
              'accessibility-checker': '♿ WCAG Compliance, A11y Monitoring, User Experience',
              'price-oracle': '💰 Multi-Source Price Feeds, XRPL, Market Data',
              'recovery-manager': '🔄 VS Code Recovery, Auto-Screenshots, State Management',
              'asset-optimizer': '🎨 Image/CSS/JS Optimization, CDN Sync, Performance',
              'log-aggregator': '📊 Central Logging, Analytics, Error Tracking',
              'social-media-manager': '📱 Auto-Posts, Community Engagement, Analytics',
              'database-manager': '🗄️ Data Backup, Cleanup, Index Optimization'
          };
          return descriptions[botId] || 'Automatisierter Worker-Bot';
      }

      // Bot-Grid aktualisieren (für unified layout)
      function updateBotsGrid(bots) {
          const grid = document.getElementById('bots-grid');
          if (!grid) return;

          grid.innerHTML = bots.map(bot => createBotCard(bot)).join('');
      }

      // Mock-Daten mit erweiterten Bots
      function loadMockData() {
          const mockData = {
              timestamp: Date.now(),
              orchestratorStatus: 'running',
              bots: [
                  // Kritische Bots
                  {
                      id: 'deployment-pipeline',
                      name: '🚀 Deployment Pipeline',
                      status: 'running',
                      pid: 1001,
                      uptime: 7200000,
                      health: { status: 'healthy', score: 98, issues: [] },
                      metrics: { memory: 65, cpu: 18, errorRate: 0 },
                      lastStart: Date.now() - 7200000,
                      restartCount: 0,
                      errors: []
                  },
                  {
                      id: 'production-monitor',
                      name: '🔴 Production Monitor',
                      status: 'running',
                      pid: 1002,
                      uptime: 3600000,
                      health: { status: 'healthy', score: 99, issues: [] },
                      metrics: { memory: 42, cpu: 12, errorRate: 0 },
                      lastStart: Date.now() - 3600000,
                      restartCount: 0,
                      errors: []
                  },
                  {
                      id: 'github-repository-manager',
                      name: '📦 GitHub Repository Manager',
                      status: 'running',
                      pid: 1003,
                      uptime: 5400000,
                      health: {
                          status: 'healthy',
                          score: 85,
                          issues: [],
                          metrics: { openIssues: 12, closedIssues: 67, openPRs: 3, mergedPRs: 28 }
                      },
                      metrics: { memory: 78, cpu: 15, errorRate: 1 },
                      lastStart: Date.now() - 5400000,
                      restartCount: 0,
                      errors: []
                  },
                  {
                      id: 'security-watchdog',
                      name: '🛡️ Security Watchdog',
                      status: 'running',
                      pid: 1004,
                      uptime: 1800000,
                      health: { status: 'healthy', score: 92, issues: [] },
                      metrics: { memory: 95, cpu: 22, errorRate: 0 },
                      lastStart: Date.now() - 1800000,
                      restartCount: 1,
                      errors: []
                  },

                  // Wichtige Bots
                  {
                      id: 'gemini-ai-chef',
                      name: '🧠 Gemini AI Chef Bot',
                      status: 'warning',
                      pid: 2001,
                      uptime: 900000,
                      health: { status: 'warning', score: 65, issues: ['API Rate Limit erreicht'] },
                      metrics: { memory: 180, cpu: 45, errorRate: 3 },
                      lastStart: Date.now() - 900000,
                      restartCount: 2,
                      errors: []
                  },
                  {
                      id: 'google-search-console-bot',
                      name: '🔍 Google Search Console Bot',
                      status: 'running',
                      pid: 2002,
                      uptime: 2700000,
                      health: { status: 'healthy', score: 88, issues: [] },
                      metrics: { memory: 55, cpu: 10, errorRate: 0 },
                      lastStart: Date.now() - 2700000,
                      restartCount: 0,
                      errors: []
                  },
                  {
                      id: 'performance-monitor',
                      name: '⚡ Performance Monitor',
                      status: 'running',
                      pid: 2003,
                      uptime: 3600000,
                      health: { status: 'healthy', score: 95, issues: [] },
                      metrics: { memory: 45, cpu: 12, errorRate: 0 },
                      lastStart: Date.now() - 3600000,
                      restartCount: 0,
                      errors: []
                  },

                  // Hilfs-Bots
                  {
                      id: 'price-oracle',
                      name: '💰 Price Oracle',
                      status: 'error',
                      pid: null,
                      uptime: 0,
                      health: { status: 'error', score: 0, issues: ['API connection failed'] },
                      metrics: { memory: 0, cpu: 0, errorRate: 5 },
                      lastStart: null,
                      restartCount: 3,
                      errors: [{ timestamp: Date.now(), error: 'Connection refused', type: 'api_error' }]
                  },
                  {
                      id: 'social-media-manager',
                      name: '📱 Social Media Manager',
                      status: 'stopped',
                      pid: null,
                      uptime: 0,
                      health: { status: 'unknown', score: 0, issues: [] },
                      metrics: { memory: 0, cpu: 0, errorRate: 0 },
                      lastStart: null,
                      restartCount: 0,
                      errors: []
                  }
              ]
          };

          updateStatusOverview(mockData);

          if (currentLayout === 'priority') {
              updateBotsByPriority(mockData.bots);
          } else {
              updateBotsGrid(mockData.bots);
          }
      }

      // Initialisierung
      document.addEventListener('DOMContentLoaded', () => {
          refreshData();
          startAutoRefresh();
      });
    </script>
  </body>
</html>
