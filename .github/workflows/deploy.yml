name: Deploy BurniToken Website

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

env:
  NODE_VERSION: '18'

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pages: write
      id-token: write
      
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4
        
      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          
      - name: ğŸ“¥ Install dependencies
        run: npm ci
        
      - name: ğŸ” Validate files
        run: |
          echo "âœ… Validating website files..."
          test -f index.html && echo "âœ… index.html found" || exit 1
          test -d assets && echo "âœ… assets/ found" || exit 1
          test -f sw.js && echo "âœ… Service Worker found" || exit 1
          test -f _headers && echo "âœ… Security headers found" || exit 1
          echo "âœ… All critical files present"
        
      - name: ğŸ”¨ Build and optimize
        run: |
          npm run build:production
          echo "âœ… Production build completed successfully"
        
      - name: ğŸ” Validate optimized build
        run: |
          echo "âœ… Validating optimized build..."
          test -f ./dist/index.html && echo "âœ… dist/index.html found" || exit 1
          test -d ./dist/assets && echo "âœ… dist/assets/ found" || exit 1
          test -f ./dist/sw.js && echo "âœ… dist/sw.js found" || exit 1
          echo "âœ… Optimized build validated"
        
      - name: ğŸš€ Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
          exclude_assets: '.github'
          enable_jekyll: false
          cname: burnitoken.website
