name: Automated Project Monitoring & Lighthouse Audits

on:
  schedule:
    - cron: '0 */2 * * *' # Every 2 hours
  workflow_dispatch: # Manual start

jobs:
  run-checks:
    name: ğŸ›¡ï¸ Run Unified Health Checks
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ“¦ Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“¥ Install dependencies
        run: npm ci

      - name: ğŸƒ Run Unified Monitoring Service
        run: node tools/unified-monitoring-service.js --silent
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          ALERT_EMAIL_USER: ${{ secrets.ALERT_EMAIL_USER }}
          ALERT_EMAIL_PASS: ${{ secrets.ALERT_EMAIL_PASS }}

  lighthouse-audit:
    name: ğŸ’¡ Run Lighthouse Audits
    runs-on: ubuntu-latest
    needs: run-checks
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ“¦ Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ğŸ“¥ Install dependencies
        run: npm ci

      - name: ğŸƒ Run Lighthouse Performance Audit
        run: npx lhci autorun --config=./lighthouserc-performance.js

      - name: ğŸƒ Run Lighthouse SEO Audit
        run: npx lhci autorun --config=./lighthouserc-seo.js

      - name: ğŸƒ Run Lighthouse Accessibility Audit
        run: npx lhci autorun --config=./lighthouserc-accessibility.js

      - name: ğŸ“Š Upload Lighthouse Reports
        uses: actions/upload-artifact@v4
        with:
          name: lighthouse-reports
          path: ./.lighthouseci/
